# ===================================
# Spring Boot Dashboard Backend Configuration
# ===================================

# 서버 설정
server.port=8080
server.servlet.context-path=/

# 애플리케이션 정보
spring.application.name=dashboard-backend

# ===================================
# PostgreSQL 데이터베이스 설정 (메인 DB)
# ===================================
spring.datasource.url=jdbc:postgresql://0.tcp.jp.ngrok.io:17059/manufacturing_dashboard
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.username=postgres
spring.datasource.password=1234

# 커넥션 풀 설정
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ===================================
# JPA/Hibernate 설정 (PostgreSQL용)
# ===================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# ===================================
# InfluxDB 3.x 설정 (시계열 데이터용) - Spring Boot 자동 인식
# ===================================
# 기본 연결 설정
influxdb.url=https://ad0a9970b150.ngrok.app
influxdb.token=apiv3_cEbVg1AZ9vV8n6ldeFVBf_ZocFlxa170VAQ4Aq2uUHVUuE63fvdu5VSVhSiQvvPlCUVBSx4TD4b9fl_G334ISw
influxdb.database=factory

# 타임아웃 설정
spring.influxdb.connection-timeout=30s
spring.influxdb.read-timeout=60s
spring.influxdb.write-timeout=30s

# 압축 설정
spring.influxdb.compression-enabled=true

# ===================================
# JSON 설정
# ===================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=Asia/Seoul
spring.jackson.serialization.write-durations-as-timestamps=false


# ===================================
# 로그 설정
# ===================================
# 전체 로그 레벨을 WARN으로 설정하여 불필요한 로그 제거
logging.root.level=WARN

# MQTT 관련 로그만 INFO 레벨로 설정
logging.level.com.u1mobis.dashboard_backend.mqtt=INFO
logging.level.com.u1mobis.dashboard_backend.service.KPICalculationService=INFO

# SQL 로그 끄기
spring.jpa.show-sql=false
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# ===================================
# JWT 보안 설정
# ===================================
# JWT Secret (환경변수로 설정 권장: JWT_SECRET)
jwt.secret=${JWT_SECRET:u1mobis-dashboard-very-secure-secret-key-for-jwt-token-generation-2024}
jwt.issuer=u1mobis-dashboard
jwt.expiration=86400
jwt.refresh-expiration=604800

# JWT 키 로테이션
jwt.key-rotation.enabled=true
jwt.key-rotation.interval-hours=24

# ===================================
# 패스워드 정책 설정
# ===================================
# 패스워드 복잡도 요구사항
password.policy.min-length=12
password.policy.max-length=128
password.policy.require-uppercase=true
password.policy.require-lowercase=true
password.policy.require-digits=true
password.policy.require-special=true

# 패스워드 히스토리 및 만료
password.policy.history-count=5
password.policy.expiry-days=90
password.policy.block-common=true

# ===================================
# Rate Limiting 설정 (브루트포스 방지)
# ===================================
# 로그인 시도 제한
security.rate-limit.login.max-attempts=10
security.rate-limit.login.window-minutes=15

# API 요청 제한
security.rate-limit.api.max-requests=100
security.rate-limit.api.window-minutes=1

# 회원가입 시도 제한
security.rate-limit.registration.max-attempts=5
security.rate-limit.registration.window-minutes=60

# ===================================
# 보안 헤더 설정
# ===================================
# HSTS (HTTP Strict Transport Security)
security.headers.hsts.enabled=true
security.headers.hsts.max-age=31536000
security.headers.hsts.include-subdomains=true

# CSP (Content Security Policy)
security.headers.csp.enabled=true
security.headers.csp.policy=default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' ws: wss:; object-src 'none'; base-uri 'self';

# 기타 보안 헤더
security.headers.frame-options=DENY
security.headers.content-type-options=nosniff
security.headers.referrer-policy=strict-origin-when-cross-origin
security.headers.permissions-policy=geolocation=(), microphone=(), camera=()

# ===================================
# 기업 검증 시스템 설정
# ===================================
# 기업 검증 활성화
enterprise.verification.enabled=true
enterprise.verification.strict-mode=false

# 외부 API 키 (환경변수로 설정 권장)
enterprise.verification.api.business-registry-key=${BUSINESS_REGISTRY_API_KEY:}

# ===================================
# 암호화된 기업 토큰 설정
# ===================================
# 토큰 로테이션
enterprise.token.rotation.enabled=true
enterprise.token.rotation.interval-hours=24

# 토큰 유효 기간
enterprise.token.validity-hours=72

# 암호화 알고리즘
enterprise.token.encryption.algorithm=AES/CBC/PKCS5Padding

# ===================================
# 스마트 초대 시스템 설정
# ===================================
# 초대 링크 기본 URL
smart.invitation.base-url=${FRONTEND_BASE_URL:http://localhost:3000}

# 초대 유효 시간 (분)
smart.invitation.validity-minutes=30

# 최대 사용 횟수
smart.invitation.max-uses=1

# 정리 주기 (분)
smart.invitation.cleanup-interval-minutes=15

# ===================================
# 관리 엔드포인트 설정
# ===================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always